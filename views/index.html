<!DOCTYPE html>
<html>
  <head>
    <title>DApps mimic</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.4.2/dist/css/uikit.min.css" />
    <!-- UIkit JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/uikit@3.4.2/dist/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/uikit@3.4.2/dist/js/uikit-icons.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <!-- web3 -->
    <script src="https://unpkg.com/web3@latest/dist/web3.min.js"></script>
    <script type="text/javascript" src='/js/main.js'></script>
  </head>
  <body>
    <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">
      <div class="header">
        <h2>DApps mimic</h2>
        <div>
          <% if (address) { %>
            <a class="uk-button uk-button-primary" onclick="disconnect();">Disconnect</a>
            <div class="uk-alert address"><%= address %></div>
          <% } else { %>
            <a class="uk-button uk-button-primary" onclick="connect();">Connect</a>
          <% } %>
        </div>
      </div>
      <div class="body">
        <% if (address) { %>
        <div class="uk-margin">
          <div class="uk-alert" id="response" style="display: none;">
        </div>

        <h4># SendTransaction</h4>
        <div class="uk-margin">
          <input type="text" class="uk-input" id="to" placeholder="To address (0x...)" value="">
        </div>
        <div class="uk-margin">
          <input type="text" class="uk-input" id="eth" placeholder="ETH" value="">
        </div>
        <div class="uk-margin">
          <button class="uk-button uk-button-primary" onclick="send();">Send</button>
        </div>
        <% } %>
        <script type="text/javascript">
          async function send() {
            try {
              if (!'<%= address %>') {
                await personalSign();
              }
              let toElement = document.getElementById('to');
              let ethElement = document.getElementById('eth');
              let resElement = document.getElementById('response');
              const to = toElement.value;
              const eth = ethElement.value;
              sendTransaction(to, eth, function(network, txHash, err) {
                resElement.style.display = 'block';
                if (err) {
                  resElement.innerHTML = err;
                  return
                }
                toElement.value = '';
                ethElement.value = '';
                const url = 'https://' + network + '.etherscan.io/tx/' + txHash;
                resElement.innerHTML = '<a href=' + url + ' target="_blank">' + url + '</a>';
              });
            } catch (err) {
              alert(err);
            }
          }
        </script>
      </div>
    </div>
  </body>
</html>
